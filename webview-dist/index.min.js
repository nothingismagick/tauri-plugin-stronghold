/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var t,e,r=function(){return(r=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)};function n(t,e,r,n){return new(r||(r=Promise))((function(o,s){function a(t){try{u(n.next(t))}catch(t){s(t)}}function i(t){try{u(n.throw(t))}catch(t){s(t)}}function u(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,i)}u((n=n.apply(t,e||[])).next())}))}function o(t,e){var r,n,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return s={next:i(0),throw:i(1),return:i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s;function i(s){return function(i){return function(s){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&s[0]?n.return:s[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,s[1])).done)return o;switch(n=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,n=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!((o=(o=a.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=e.call(t,a)}catch(t){s=[6,t],n=0}finally{r=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,i])}}}function s(t,e){void 0===e&&(e=!1);var r=window.crypto.getRandomValues(new Uint32Array(1))[0],n="_".concat(r);return Object.defineProperty(window,n,{value:function(r){return e&&Reflect.deleteProperty(window,n),null==t?void 0:t(r)},writable:!1,configurable:!0}),r}function a(t,e){return void 0===e&&(e={}),n(this,void 0,void 0,(function(){return o(this,(function(n){return[2,new Promise((function(n,o){var a=s((function(t){n(t),Reflect.deleteProperty(window,i)}),!0),i=s((function(t){o(t),Reflect.deleteProperty(window,a)}),!0);window.__TAURI_IPC__(r({cmd:t,callback:a,error:i},e))}))]}))}))}function i(t){return n(this,void 0,void 0,(function(){return o(this,(function(e){return[2,a("tauri",t)]}))}))}function u(t){return n(this,void 0,void 0,(function(){return o(this,(function(e){return[2,i({__tauriModule:"Event",message:{cmd:"unlisten",eventId:t}})]}))}))}function h(t,e,r){return n(this,void 0,void 0,(function(){return o(this,(function(n){switch(n.label){case 0:return[4,i({__tauriModule:"Event",message:{cmd:"emit",event:t,windowLabel:e,payload:"string"==typeof r?r:JSON.stringify(r)}})];case 1:return n.sent(),[2]}}))}))}function l(t,e,r){return n(this,void 0,void 0,(function(){var a=this;return o(this,(function(h){return[2,i({__tauriModule:"Event",message:{cmd:"listen",event:t,windowLabel:e,handler:s(r)}}).then((function(t){return function(){return n(a,void 0,void 0,(function(){return o(this,(function(e){return[2,u(t)]}))}))}}))]}))}))}function c(t,e,r){return n(this,void 0,void 0,(function(){return o(this,(function(n){return[2,l(t,e,(function(t){r(t),u(t.id).catch((function(){}))}))]}))}))}function p(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,l(t,null,e)]}))}))}Object.freeze({__proto__:null,transformCallback:s,invoke:a,convertFileSrc:function(t,e){return void 0===e&&(e="asset"),navigator.userAgent.includes("Windows")?"https://".concat(e,".localhost/").concat(t):"".concat(e,"://").concat(t)}}),Object.freeze({__proto__:null,listen:p,once:function(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,c(t,null,e)]}))}))},emit:function(t,e){return n(this,void 0,void 0,(function(){return o(this,(function(r){return[2,h(t,void 0,e)]}))}))}}),function(t){t[t.Dialing=0]="Dialing",t[t.Listening=1]="Listening",t[t.Both=2]="Both"}(t||(t={})),function(t){t[t.CheckVault=0]="CheckVault",t[t.CheckRecord=1]="CheckRecord",t[t.WriteToStore=2]="WriteToStore",t[t.ReadFromStore=3]="ReadFromStore",t[t.DeleteFromStore=4]="DeleteFromStore",t[t.CreateNewVault=5]="CreateNewVault",t[t.WriteToVault=6]="WriteToVault",t[t.RevokeData=7]="RevokeData",t[t.GarbageCollect=8]="GarbageCollect",t[t.ListIds=9]="ListIds",t[t.ReadSnapshot=10]="ReadSnapshot",t[t.WriteSnapshot=11]="WriteSnapshot",t[t.FillSnapshot=12]="FillSnapshot",t[t.ClearCache=13]="ClearCache",t[t.ControlRequest=14]="ControlRequest"}(e||(e={}));const d={};function g(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}var f;p("stronghold://status-change",(t=>{const{snapshotPath:e,status:r}=t.payload;for(const t of d[e]||[])t.cb(r)})),f||(f={});class v{constructor(t,e){this.type=t,this.payload=e}static generic(t,e){return new v("Generic",{vault:t,record:e})}static counter(t,e){return new v("Counter",{vault:t,counter:e})}}function m(t){return a("plugin:stronghold|set_password_clear_interval",{interval:t})}class y{constructor(t,e){this.procedureArgs=e,this.command=t?"execute_remote_procedure":"execute_procedure"}generateSLIP10Seed(t,e,r){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"SLIP10Generate",payload:{output:t,sizeBytes:e,hint:r}}})}deriveSLIP10(t,e,r,n,o){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"SLIP10Derive",payload:{chain:t,input:{type:e,payload:r},output:n,hint:o}}})}recoverBIP39(t,e,r,n){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"BIP39Recover",payload:{mnemonic:t,passphrase:r,output:e,hint:n}}})}generateBIP39(t,e,r){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"BIP39Generate",payload:{output:t,passphrase:e,hint:r}}})}getPublicKey(t){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"Ed25519PublicKey",payload:{privateKey:t}}})}sign(t,e){return a(`plugin:stronghold|${this.command}`,{...this.procedureArgs,procedure:{type:"Ed25519Sign",payload:{privateKey:t,msg:e}}})}}class _{constructor(t,e){this.path=t,this.peerId=e}get(t){return a("plugin:stronghold|get_remote_store_record",{snapshotPath:this.path,peerId:this.peerId,location:t})}insert(t,e,r){return a("plugin:stronghold|save_remote_store_record",{snapshotPath:this.path,peerId:this.peerId,location:t,record:e,lifetime:r})}}class w extends y{constructor(t,e){super(!0,{peerId:e}),this.path=t,this.peerId=e}}class P{constructor(t,e,r){this.path=t,this.name=e,this.flags=r}get vault(){return{name:this.name,flags:this.flags}}get(t){return a("plugin:stronghold|get_store_record",{snapshotPath:this.path,vault:this.vault,location:t})}insert(t,e,r){return a("plugin:stronghold|save_store_record",{snapshotPath:this.path,vault:this.vault,location:t,record:e,lifetime:r})}remove(t){return a("plugin:stronghold|remove_store_record",{snapshotPath:this.path,vault:this.vault,location:t})}}class b extends y{constructor(t,e,r){super(!1,{snapshotPath:t,vault:{name:e,flags:r}}),this.path=t,this.name=e,this.flags=r}get vault(){return{name:this.name,flags:this.flags}}insert(t,e,r){return a("plugin:stronghold|save_record",{snapshotPath:this.path,vault:this.vault,location:t,record:e,recordHint:r,flags:[]})}remove(t,e=!0){return a("plugin:stronghold|remove_record",{snapshotPath:this.path,vault:this.vault,location:t,gc:e})}}class S{constructor(t){this.path=t}stop(){return a("plugin:stronghold|stop_communication",{snapshotPath:this.path})}startListening(t){return a("plugin:stronghold|start_listening",{snapshotPath:this.path,addr:t})}getSwarmInfo(){return a("plugin:stronghold|get_swarm_info",{snapshotPath:this.path})}addPeer(e,r,n){return a("plugin:stronghold|add_peer",{snapshotPath:this.path,peerId:e,addr:r,relayDirection:n?{type:t[n]}:null})}changeRelayDirection(e,r){return a("plugin:stronghold|change_relay_direction",{snapshotPath:this.path,peerId:e,relayDirection:{type:t[r]}})}removeRelay(t){return a("plugin:stronghold|remove_relay",{snapshotPath:this.path,peerId:t})}allowAllRequests(t,e=!1){return a("plugin:stronghold|allow_all_requests",{snapshotPath:this.path,peers:t,setDefault:e})}rejectAllRequests(t,e=!1){return a("plugin:stronghold|reject_all_requests",{snapshotPath:this.path,peers:t,setDefault:e})}allowRequests(t,r,n=!1){return a("plugin:stronghold|allow_requests",{snapshotPath:this.path,peers:t,requests:r.map((t=>({type:e[t]}))),changeDefault:n})}rejectRequests(t,r,n=!1){return a("plugin:stronghold|reject_requests",{snapshotPath:this.path,peers:t,requests:r.map((t=>({type:e[t]}))),changeDefault:n})}removeFirewallRules(t){return a("plugin:stronghold|remove_firewall_rules",{snapshotPath:this.path,peers:t})}getRemoteVault(t){return new w(this.path,t)}getRemoteStore(t){return new _(this.path,t)}}class R{constructor(t,e){this.path=t,this.reload(e)}reload(t){return a("plugin:stronghold|init",{snapshotPath:this.path,password:t})}unload(){return a("plugin:stronghold|destroy",{snapshotPath:this.path})}getVault(t,e){return new b(this.path,t,e)}getStore(t,e){return new P(this.path,t,e)}save(){return a("plugin:stronghold|save_snapshot",{snapshotPath:this.path})}getStatus(){return a("plugin:stronghold|get_status",{snapshotPath:this.path})}onStatusChange(t){void 0===d[this.path]&&(d[this.path]=[]);const e=g()+g()+"-"+g()+"-"+g()+"-"+g()+"-"+g()+g()+g();return d[this.path].push({id:e,cb:t}),()=>{d[this.path]=d[this.path].filter((t=>t.id!==e))}}spawnCommunication(){return a("plugin:stronghold|spawn_communication",{snapshotPath:this.path}).then((()=>new S(this.path)))}}export{S as Communication,v as Location,t as RelayDirection,_ as RemoteStore,w as RemoteVault,e as RequestPermission,P as Store,R as Stronghold,f as StrongholdFlag,b as Vault,m as setPasswordClearInterval};
